---
title: SQL 로 WAU 구하기
categories:
- SQL
- WAU
- TRUNC
feature_image: "https://picsum.photos/2560/600?image=872"
---
쿼리 테스트 준비를 하면서 데이터 분석을 위한 SQL 에 대해 공부를 하는 중이다.  
사용할 SQL 은 그나마 내가 제일 많이 사용해본 MySQL 을 사용할 예정이다.
먼저 'Mode' 사이트에서 제공하는 Yammer 라는 회사의 사용자 추이를 분석하는 것을 따라가면서 공부를 해보려 한다.  
## 분석 케이스: Yammer
Yammer 는 coworker 간의 커뮤니케이션을 위한 소셜 네트워크 서비스이다. Yammer 는 무료 서비스이나, 유저 관리 시스템을 포함한 관리 제어 시스템에 접속하려면 각 회사에서 라이선스료를 따로 지급해야 사용 가능한 시스템이다.  
Yammer는 데이터 분석 팀이 있으며, 그들의 목표는 데이터를 활용해서 더 나은 제품과 비즈니스를 제공하는 것이다. 우선 해야할 일은 제품이나 비즈니스에 문제가 있는지 없는지 분류하는 작업이다. 많은 경우에서 이러한 문제점은 관리자가 확인하는 주요 지표 대시보드에서 표면적으로 드러나게 된다.

### 문제
우선 주어진 과제는 최근 유저 활동 대시보드에서 유저들의 활성 상태를 체크하는 일이다.  
주로 사용되는 지표는 일일 활성 사용자 수(DAU), 주간 활성 사용자 수(WAU), 월간 활성 사용자 수(MAU) 등 특정 기간 동안의 활성 사용자 수의 변화를 파악하는 것이다. 게임과 같이 사용자가 하루에 여러번 복귀하는데 중점을 두는 모바일 앱의 경우 DAU 를 주로 사용하며, Slack, Trello 등 비즈니스에 중점을 두는 앱의 경우 주중 주말의 편차가 크다는 점이 있으므로 WAU 를 주로 사용한다. MAU는 앱의 고착도, 사용자 유지율 파악 등 중요 지표 계산에 이용된다.
WAU 를 구하기 위해 아래와 같은 쿼리문을 작성하였다.  

```SQL
SELECT 
    DATE_FORMAT(e.occurred_at, '%Y-%u') AS week,
    COUNT(DISTINCT e.user_id) AS weekly_active_users
FROM 
    tutorial.yammer_events e
WHERE 
    e.event_type = 'engagement'
    AND e.event_name = 'login'
GROUP BY 
    week
ORDER BY 
    week;
 ```

위의 쿼리문에서 ```DATE_FORMAT()``` 함수는 MySQL에서 DATE 객체를 특정 형식으로 포멧을 맞춰주는 역할을 한다. 여기서 ```%Y``` 와 ```%u``` 는 각각 연도와 주 번호를 의미하며, 주간 데이터 그룹화를 위해 연도와 주 번호로 변환을 시켜준다. 이후 각 주의 고유 사용자 ID 수를 카운팅하기 위해 ```COUNT(DISTINCT user_id)``` 함수를 사용해 주간 활성 사용자 수를 구하며, 그룹화를 위해 마지막에 ```GROUP BY``` 를 사용하여 각 주의 사용자를 집계한다.