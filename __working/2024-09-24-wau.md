---
title: SQL 로 WAU 구하기
categories:
- SQL
- WAU
- TRUNC
feature_image: "https://picsum.photos/2560/600?image=872"
---
이제 본격적으로 데이터 분석을 위한 SQL 에 대해 공부해본다.  
먼저 'Mode' 사이트에서 제공하는 Yammer 라는 회사의 사용자 추이를 분석하는 것을 따라가면서 공부해보자.  
## 분석 케이스: Yammer
Yammer 는 coworker 간의 커뮤니케이션을 위한 소셜 네트워크 서비스이다. Yammer 는 무료 서비스이나, 유저 관리 시스템을 포함한 관리 제어 시스템에 접속하려면 각 회사에서 라이선스료를 따로 지급해야 사용 가능한 시스템이다.  
Yammer는 데이터 분석 팀이 있으며, 그들의 목표는 데이터를 활용해서 더 나은 제품과 비즈니스를 제공하는 것이다. 우선 해야할 일은 제품이나 비즈니스에 문제가 있는지 없는지 분류하는 작업이다. 많은 경우에서 이러한 문제점은 관리자가 확인하는 주요 지표 대시보드에서 표면적으로 드러나게 된다.

### 문제
우선 주어진 과제는 최근 유저 활동 대시보드에서 유저들의 활성 상태를 체크하는 일이다.  
주로 사용되는 지표는 일일 활성 사용자 수(DAU), 주간 활성 사용자 수(WAU), 월간 활성 사용자 수(MAU) 등 특정 기간 동안의 활성 사용자 수의 변화를 파악하는 것이다. 게임과 같이 사용자가 하루에 여러번 복귀하는데 중점을 두는 모바일 앱의 경우 DAU 를 주로 사용하며, Slack, Trello 등 비즈니스에 중점을 두는 앱의 경우 주중 주말의 편차가 크다는 점이 있으므로 WAU 를 주로 사용한다. MAU는 앱의 고착도, 사용자 유지율 파악 등 중요 지표 계산에 이용된다.
먼저 Yammer 의 yammer_events 테이블을 사용해 WAU 를 구하기 위한 쿼리문을 짜보면 다음과 같다.

```SQL
SELECT DATE_TRUNC('week', e.occurred_at),
       COUNT(DISTINCT e.user_id) AS weekly_active_users
  FROM tutorial.yammer_events e
 WHERE e.event_type = 'engagement'
   AND e.event_name = 'login'
 GROUP BY 1
 ORDER BY 1;
 ```
여기서 DATE_TRUNC 를 사용해 주 별로 데이터를 truncation 하는 것을 알 수 있다. 만약 DAU, MAU를 보고 싶다면 'week' 대신 'day' 또는 'month' 를 사용하면 된다. 
